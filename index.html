<!doctype html>
<!--[if gt IE 8]><!--> <html class="no-js" lang=""> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title></title>
        <meta name="description" content="">

        <link rel="stylesheet" href="assets/css/bootstrap.min.css">

        <!--For Plugins external css-->
        <link rel="stylesheet" href="assets/css/plugins.css" />

        <!--Theme custom css -->
        <link rel="stylesheet" href="assets/css/style.css">

        <!--Theme Responsive css-->
        <link rel="stylesheet" href="assets/css/responsive.css" />

    </script>
    
    
    <!-- Styles -->	
    <style style="text/css">
    
    h2 {
        background-color: lightgrey;
        font-size: 150%;
        margin-left: 40px;
        margin-top: 30px;
        }
    h3 {
        background-color: lightgrey;
        font-size: 100%;
        margin-left: 40px;
        }
    p {
        background-color: white;
        font-size: 90%;
        margin-top: 40px;
        margin-bottom: 40px;
        margin-left: 40px;
        }
        
    img { 
        width:100%; 
        margin-top: 30px;
        }   
        
    body {
        overflow:scroll;
        margin:0;
        }
    text {
        font-family: sans-serif;
        pointer-events: auto;
        }

    .chart { 
      background: #fff;
    }
    p {
      font: 12px helvetica;
    }
    .axis path, .axis line {
      fill: none;
      stroke: #000;
      stroke-width: 2px;
      shape-rendering: crispEdges;
    }   
    .axis { font: 10px sans-serif; }

    button {
      position: absolute;
      right: 50px;
      top: 10px;
      border:1px solid red;
    }  
    
    .tooltip {
      position: absolute;
      text-align: center;
      width: 60px;
      height: 12px;
      padding: 8px;
      margin-top: -20px;
      font: 12px sans-serif;
      background: #ddd;
    }
        
    </style>
    
    </head>
    <body>

    <div class="container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <div class="chart"> </div>
                    <!--<body data-spy="scroll" data-target="#main-navbar"> -->
                    <img class="profile-pic" src="ski_abay_selfie_crop.png" alt="HTML5 Icon" style="width:128px;height:128px;" align="left" hspace="40">
        </div>
    </div>
    <div class="row">
        <div class="col-sm-12">
                <!--Home page style-->
        <header id="home" class="sections">
            <div class="container">

                <div class="row">
                    <div class="homepage-style">
                        <!-- Define page width for Desktop, Tablet, and Phone -->
                        <div class="col-md-10 col-sm-6 col-xs-12">
                            <div class="unique-apps">
                                <h2>&nbsp; Matt Wheeler<br>&nbsp; Visualization | Web Analytics | Data Science</h2>
                                <h3>&nbsp; Passionate about drawing insights from data
                                    <br>
                                    &nbsp;
                                    <a target="_blank" href="https://www.linkedin.com/in/matthew-wheeler/">LinkedIn</a>
                                    &nbsp;&nbsp;&nbsp;
                                    <a target="_blank" href="https://public.tableau.com/profile/matt.wheeler#!/">Tableau Public</a>      

                                </h3>
                                <p>
                                    Interested in behavorial economics, evolutionary biology, genetics, AI research, and anything else where data 
                                    can be visualized.  Usually pondering over literary works by Edward Tufte, Daniel Kahneman, Richard Dawkins, and Sean Carroll.  
                                    <br>
                                    <br>
                                    Some amusing links: 
                                    <br> &nbsp; <a target="_blank" href="http://www.infocaptor.com/bubble-my-page">Word bubble any webpage</a>
                                    <br> &nbsp; <a target="_blank" href="http://gravyanecdote.com/">GravyAnecdote</a>
                                    <br> &nbsp; <a target="_blank" href="https://www.reddit.com/r/dataisbeautiful/">  r/Dataisbeautiful</a>
                                    <br> &nbsp; <a target="_blank" href="http://flowingdata.com/"> FlowingData </a>
                                    <br> &nbsp; <a target="_blank" href="https://www.ventusky.com"> Ventusky Meteorlogical Data Visualization </a>    
                                    <br>
                                    <br>
                                    Below are a few of my D3.js projects.
                                  
                                </p>    

                            </div>
                        </div>
                    </div>
                </div>
            </div>
         </header>
        </div>
    </div>
    <div class="row"> 
        <div class="col-sm-12"> 
            <div class="col-md-6" id="area2"></div>
            <div class="col-md-6" id="area1"></div>
        </div>
    </div>
 </div>

 
 <!-- Streamgraph -->
<script src="https://d3js.org/d3.v2.js"></script>
<div class="chart">
</div>

<script>
chart("tech_stocks_1yr.csv", "pink");

var datearray = [];
var colorrange = [];

function chart(csvpath, color) {

if (color == "blue") {
  colorrange = ["#045A8D", "#2B8CBE", "#74A9CF", "#A6BDDB", "#D0D1E6", "#F1EEF6"];
}
else if (color == "pink") {
  colorrange = ["#980043", "#DD1C77", "#DF65B0", "#C994C7", "#D4B9DA", "#F1EEF6"];
}
else if (color == "orange") {
  colorrange = ["#B30000", "#E34A33", "#FC8D59", "#FDBB84", "#FDD49E", "#FEF0D9"];
}
strokecolor = colorrange[0];

var format = d3.time.format("%m/%d/%y");

//define your year format here, first for the x scale, then if the date is displayed in tooltips
//var parseDate = d3.time.format("%m/%d/%y").parse;
var formatDate = d3.time.format("%b %d, '%y");

var margin = {top: 20, right: 150, bottom: 70, left: 150};
var width = document.body.clientWidth - margin.left - margin.right;
var height = 400 - margin.top - margin.bottom;

var tooltip = d3.select("body")
    .append("div")
    .attr("class", "remove")
    .style("position", "absolute")
    .style("z-index", "10")
    .style("visibility", "hidden")
    .style("top", "330px")
    .style("left", "120px")
    .style("opacity", 1);

var x = d3.time.scale()
    .range([0, width]);

var y = d3.scale.linear()
    .range([height-10, 0]);

var z = d3.scale.ordinal()
    .range(colorrange);

var xAxis = d3.svg.axis()
    .scale(x)
    .orient("bottom")
    .ticks(d3.time.months);

var yAxis = d3.svg.axis()
    .scale(y);

var yAxisr = d3.svg.axis()
    .scale(y)
    .tickFormat(function(d) { return "$" + commaFormatter(d); });

var stack = d3.layout.stack()
    .offset("silhouette")
    .values(function(d) { return d.values; })
    .x(function(d) { return d.date; })
    .y(function(d) { return d.value; });

var nest = d3.nest()
    .key(function(d) { return d.key; });

var area = d3.svg.area()
    .interpolate("cardinal")
    .x(function(d) { return x(d.date); })
    .y0(function(d) { return y(d.y0); })
    .y1(function(d) { return y(d.y0 + d.y); });

var svg2 = d3.select("#area2").append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
    .append("g")
    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    
svg2.append("text")
    .attr("x", width/2)
    .attr("y", -7)
    .style("text-anchor", "middle")
    .style("fill","darkblue")
    .text("1yr Streamgraph of Tech Stocks (NFLX, FB, GOOG, AMZN, APPL)");

var graph = d3.csv(csvpath, function(data) {
  data.forEach(function(d) {
    d.date = format.parse(d.date);
    d.value = +d.value;
  });

  var layers = stack(nest.entries(data));

  x.domain(d3.extent(data, function(d) { return d.date; }));
  y.domain([0, d3.max(data, function(d) { return d.y0 + d.y; })]);

  svg2.selectAll(".layer")
      .data(layers)
    .enter().append("path")
      .attr("class", "layer")
      .attr("d", function(d) { return area(d.values); })
      .style("fill", function(d, i) { return z(i); });

  svg2.append("g")
      .attr("class", "x axis")
      .attr("transform", "translate(0," + height + ")")
      .call(xAxis);

  svg2.append("g")
      .attr("class", "y axis")
      .attr("transform", "translate(" + width + ", 0)")
      .call(yAxis.orient("right"));
       
  svg2.selectAll(".layer")
    .attr("opacity", 1)
    .on("mouseover", function(d, i) {
      svg2.selectAll(".layer").transition()
      .duration(250)
      .attr("opacity", function(d, j) {
        return j != i ? 0.6 : 1;
    })})

    .on("mousemove", function(d, i) {
      mousex = d3.mouse(this);
      mousex = mousex[0];
      var invertedx = x.invert(mousex);
      invertedx = invertedx.getMonth() + invertedx.getDay();
      var selected = (d.values);
      for (var k = 0; k < selected.length; k++) {
        datearray[k] = selected[k].date
        datearray[k] = datearray[k].getMonth() + datearray[k].getDay();
      }
     
      mousedate = datearray.indexOf(invertedx);
      
      pro = d.values[mousedate].value;
      dt = d.values[mousedate].date;
      
      

      d3.select(this)
      .classed("hover", true)
      .attr("stroke", strokecolor)
      .attr("stroke-width", "0.5px"), 
      tooltip.html( "<p>" + d.key + "<br>" + pro + "<br>" + formatDate(dt) + "</p>" ).style("visibility", "visible");
      
    })
    .on("mouseout", function(d, i) {
     svg2.selectAll(".layer")
      .transition()
      .duration(250)
      .attr("opacity", "1");
      d3.select(this)
      .classed("hover", false)
      .attr("stroke-width", "0px"), tooltip.html( "<p>" + d.key + "<br>" + pro + "<br>" + formatDate(dt) + "</p>" ).style("visibility", "hidden");
  })
    
  var vertical = d3.select(".chart")
        .append("div")
        .attr("class", "remove")
        .style("position", "absolute")
        .style("z-index", "19")
        .style("width", "1px")
        .style("height", "380px")
        .style("top", "10px")
        .style("bottom", "30px")
        .style("left", "0px")
        .style("background", "#fff");

  d3.select(".chart")
      .on("mousemove", function(){  
         mousex = d3.mouse(this);
         mousex = mousex[0] + 5;
         vertical.style("left", mousex + "px" )})
      .on("mouseover", function(){  
         mousex = d3.mouse(this);
         mousex = mousex[0] + 5;
         vertical.style("left", mousex + "px");})
});
}
</script>

<hr>
 
<!-- Force-directed chart -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>
<script>


var w = window.innerWidth/6;
var h = window.innerHeight/4;
var keyc = true, keys = true, keyt = true, keyr = true, keyx = true, keyd = true, keyl = true, keym = true, keyh = true, key1 = true, key2 = true, key3 = true, key0 = true
var focus_node = null, highlight_node = null;
var text_center = false;
var outline = false;
var min_score = 0;
var max_score = 1;
var color = d3.scale.category10();
var highlight_color = "blue";
var highlight_trans = 0.1;
var size = d3.scale.pow().exponent(1)
    .domain([1,100])
    .range([4,24]);
var force = d3.layout.force()
    .linkDistance(80)
    .charge(-200)
    .size([w,h]);
var default_node_color = "#ccc";
//var default_node_color = "rgb(3,190,100)";
var default_link_color = "#888";
var nominal_base_node_size = 8;
var nominal_text_size = 10;
var max_text_size = 24;
var nominal_stroke = 1.5;
var max_stroke = 4.5;
var max_base_node_size = 36;
var min_zoom = 0.1;
var max_zoom = 7;
var svg1 = d3.select("#area1").append("svg");
svg1.append("text")
    .attr("x", w*3)
    .attr("y", 15)
    .style("text-anchor", "middle")
    .style("fill","darkblue")
    .text("Force-directed Colorado Ski Resorts by Season Pass");
 
var zoom = d3.behavior.zoom().scaleExtent([min_zoom,max_zoom])
var g = svg1.append("g");
svg1.style("cursor","move");
d3.json("co_ski_sort_clusters.json", function(error, graph) {
    var linkedByIndex = {};
    graph.links.forEach(function(d) {
        linkedByIndex[d.source + "," + d.target] = true;
    });
    function isConnected(a, b) {
        return (
            linkedByIndex[a.index + "," + b.index]
            || linkedByIndex[b.index + "," + a.index]
            || a.index == b.index);
    }
    function hasConnections(a) {
        for (var property in linkedByIndex) {
            s = property.split(",");
            if ((s[0] == a.index || s[1] == a.index) && linkedByIndex[property]) {
                return true;
            }
        }
        return false;
    }
    force
        .nodes(graph.nodes)
        .links(graph.links)
        .start();
        
    var link = g.selectAll(".link")
        .data(graph.links)
        .enter().append("line")
        .attr("class", "link")
        .style("stroke-width",nominal_stroke)
        .style("stroke", function(d) {
            if (isNumber(d.score) && d.score>=0) return color(d.score);
            else return default_link_color; })
      
    // Define nodes: color to correspond with d.Pass  
    var node = g.selectAll(".node")
        .data(graph.nodes)
        .enter().append("g")
        .attr("class", "node")
        .style("fill", function(d) { return color(d.Pass); })
        .call(force.drag)
        node.on("dblclick.zoom", function(d) { d3.event.stopPropagation();
    
        var dcx = (window.innerWidth/2-d.x*zoom.scale());
        var dcy = (window.innerHeight/2-d.y*zoom.scale());
        zoom.translate([dcx,dcy]);
        g.attr("transform", "translate("+ dcx + "," + dcy  + ")scale(" + zoom.scale() + ")");
        });
    
    var tocolor = "fill";
    var towhite = "stroke";
    if (outline) {
        tocolor = "stroke"
        towhite = "fill"}
        
    var circle = node.append("path")
        .attr("d", d3.svg.symbol()
            .size(function(d) { return Math.PI*Math.pow(size(d.size)||nominal_base_node_size,2); })
            .type(function(d) { return d.type; }))
        .style(tocolor, function(d) {
            return color(d.Pass); })
        //.attr("r", function(d) { return size(d.size)||nominal_base_node_size; })
        .style("stroke-width", nominal_stroke)
        .style(towhite, "white");
    var text = g.selectAll(".text")
        .data(graph.nodes)
        .enter().append("text")
        .attr("dy", ".35em")
        .style("font-size", nominal_text_size + "px")
    if (text_center)
        text.text(function(d) { return d.id + ": " + d.snowfall + " in"; })
            .style("text-anchor", "middle");
    else
        text.attr("dx", function(d) {return (size(d.size)||nominal_base_node_size);})
            .text(function(d) { return '\u2002'+ d.id + ": " + d.snowfall + " in"; });
          
     <!-- standard legend creation -->     
    var legend = svg1.selectAll(".legend")
        .data(color.domain())
        .enter().append("g")
        .attr("class", "legend")
        .attr("transform", function(d, i) { return "translate(0," + i * 20 + ")"; });      
          
    legend.selectAll('rect')
      .data(graph)
      .enter()

    legend.append("rect")
        .attr("x", w - 18)
        .attr("width", 18)
        .attr("height", 18)
        .style("fill", color);

    legend.append("text")
        .attr("x", w - 24)
        .attr("y", 9)
        .attr("dy", ".35em")
        .style("text-anchor", "end")
        .text(function(d) { return d; });

            
    node.on("mouseover", function(d) {
        set_highlight(d);
    })
        .on("mousedown", function(d) { d3.event.stopPropagation();
            focus_node = d;
            set_focus(d)
            if (highlight_node === null) set_highlight(d)
        }	).on("mouseout", function(d) {
            exit_highlight();
        }	);
    d3.select(window).on("mouseup",
        function() {
            if (focus_node!==null)
            {
                focus_node = null;
                if (highlight_trans<1)
                {
                    circle.style("opacity", 1);
                    text.style("opacity", 1);
                    link.style("opacity", 1);
                }
            }
            if (highlight_node === null) exit_highlight();
        });
    function exit_highlight()
    {
        highlight_node = null;
        if (focus_node===null)
        {
            svg1.style("cursor","move");
            if (highlight_color!="white")
            {
                circle.style(towhite, "white");
                text.style("font-weight", "normal");
                link.style("stroke", function(o) {return (isNumber(o.score) && o.score>=0)?color(o.score):default_link_color});
            }
        }
    }
    function set_focus(d)
    {
        if (highlight_trans<1)  {
            circle.style("opacity", function(o) {
                return isConnected(d, o) ? 1 : highlight_trans;
            });
            text.style("opacity", function(o) {
                return isConnected(d, o) ? 1 : highlight_trans;
            });
            link.style("opacity", function(o) {
                return o.source.index == d.index || o.target.index == d.index ? 1 : highlight_trans;
            });
        }
    }
    function set_highlight(d)
    {
        svg1.style("cursor","pointer");
        if (focus_node!==null) d = focus_node;
        highlight_node = d;
        if (highlight_color!="white")
        {
            circle.style(towhite, function(o) {
                return isConnected(d, o) ? highlight_color : "white";});
            text.style("font-weight", function(o) {
                return isConnected(d, o) ? "bold" : "normal";});
            link.style("stroke", function(o) {
                return o.source.index == d.index || o.target.index == d.index ? highlight_color : ((isNumber(o.score) && o.score>=0)?color(o.score):default_link_color);
            });
        }
    }
    zoom.on("zoom", function() {
        var stroke = nominal_stroke;
        if (nominal_stroke*zoom.scale()>max_stroke) stroke = max_stroke/zoom.scale();
        link.style("stroke-width",stroke);
        circle.style("stroke-width",stroke);
        var base_radius = nominal_base_node_size;
        if (nominal_base_node_size*zoom.scale()>max_base_node_size) base_radius = max_base_node_size/zoom.scale();
        circle.attr("d", d3.svg1.symbol()
            .size(function(d) { return Math.PI*Math.pow(size(d.size)*base_radius/nominal_base_node_size||base_radius,2); })
            .type(function(d) { return d.type; }))
        //circle.attr("r", function(d) { return (size(d.size)*base_radius/nominal_base_node_size||base_radius); })
        if (!text_center) text.attr("dx", function(d) { return (size(d.size)*base_radius/nominal_base_node_size||base_radius); });
        var text_size = nominal_text_size;
        if (nominal_text_size*zoom.scale()>max_text_size) text_size = max_text_size/zoom.scale();
        text.style("font-size",text_size + "px");
        g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
    });
    //svg.call(zoom);
    resize();
    //window.focus();
    d3.select(window).on("resize", resize).on("keydown", keydown);
    force.on("tick", function() {
        node.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
        text.attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; });
        link.attr("x1", function(d) { return d.source.x; })
            .attr("y1", function(d) { return d.source.y; })
            .attr("x2", function(d) { return d.target.x; })
            .attr("y2", function(d) { return d.target.y; });
        node.attr("cx", function(d) { return d.x; })
            .attr("cy", function(d) { return d.y; });
    });
    function resize() {
        var width = window.innerWidth, height = window.innerHeight;
        svg1.attr("width", width).attr("height", height);
        force.size([force.size()[0]+(width-w)/zoom.scale(),force.size()[1]+(height-h)/zoom.scale()]).resume();
        w = width;
        h = height;
    }
    function keydown() {
        if (d3.event.keyCode==32) {  force.stop();}
        else if (d3.event.keyCode>=48 && d3.event.keyCode<=90 && !d3.event.ctrlKey && !d3.event.altKey && !d3.event.metaKey)
        {
            switch (String.fromCharCode(d3.event.keyCode)) {
                case "C": keyc = !keyc; break;
                case "S": keys = !keys; break;
                case "T": keyt = !keyt; break;
                case "R": keyr = !keyr; break;
                case "X": keyx = !keyx; break;
                case "D": keyd = !keyd; break;
                case "L": keyl = !keyl; break;
                case "M": keym = !keym; break;
                case "H": keyh = !keyh; break;
                case "1": key1 = !key1; break;
                case "2": key2 = !key2; break;
                case "3": key3 = !key3; break;
                case "0": key0 = !key0; break;
            }
            link.style("display", function(d) {
                var flag  = vis_by_type(d.source.type)&&vis_by_type(d.target.type)&&vis_by_node_score(d.source.score)&&vis_by_node_score(d.target.score)&&vis_by_link_score(d.score);
                linkedByIndex[d.source.index + "," + d.target.index] = flag;
                return flag?"inline":"none";});
            node.style("display", function(d) {
                return (key0||hasConnections(d))&&vis_by_type(d.type)&&vis_by_node_score(d.score)?"inline":"none";});
            text.style("display", function(d) {
                return (key0||hasConnections(d))&&vis_by_type(d.type)&&vis_by_node_score(d.score)?"inline":"none";});
            if (highlight_node !== null)
            {
                if ((key0||hasConnections(highlight_node))&&vis_by_type(highlight_node.type)&&vis_by_node_score(highlight_node.score)) {
                    if (focus_node!==null) set_focus(focus_node);
                    set_highlight(highlight_node);
                }
                else {exit_highlight();}
            }
        }
    }
});
function vis_by_type(type)
{
    switch (type) {
        case "circle": return keyc;
        case "square": return keys;
        case "triangle-up": return keyt;
        case "diamond": return keyr;
        case "cross": return keyx;
        case "triangle-down": return keyd;
        default: return true;
    }
}
function vis_by_node_score(score)
{
    if (isNumber(score))
    {
        if (score>=0.666) return keyh;
        else if (score>=0.333) return keym;
        else if (score>=0) return keyl;
    }
    return true;
}
function vis_by_link_score(score)
{
    if (isNumber(score))
    {
        if (score>=0.666) return key3;
        else if (score>=0.333) return key2;
        else if (score>=0) return key1;
    }
    return true;
}
function isNumber(n) {
    return !isNaN(parseFloat(n)) && isFinite(n);
}	
</script>




</body>
</html>